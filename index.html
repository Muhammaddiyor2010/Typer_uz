<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Test your typing speed and accuracy with our interactive typing test. Choose from Easy, Medium, or Hard difficulty levels. Features dark mode and real-time statistics.">
    <meta name="keywords" content="typing test, typing speed, WPM, accuracy, keyboard, practice, typing game">
    <meta name="author" content="Typing Test App">
    <meta property="og:title" content="Typing Test - Speed & Accuracy">
    <meta property="og:description"
        content="Test your typing speed and accuracy with our interactive typing test. Choose from Easy, Medium, or Hard difficulty levels.">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <title>Typing Test - Speed & Accuracy</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⌨️</text></svg>">
    <link rel="manifest" href="manifest.json">
    <style>
        /* Custom CSS Variables */
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --hover-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Global Styles */
        body {
            background: var(--gradient-bg);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .container {
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        /* Typing Text Styles */
        .typing-text {
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .typing-text:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .correct {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            border-radius: 3px;
            padding: 1px 2px;
            animation: correctPulse 0.3s ease;
        }

        .incorrect {
            background: linear-gradient(135deg, var(--error-color), #dc2626);
            color: white;
            border-radius: 3px;
            padding: 1px 2px;
            animation: incorrectShake 0.3s ease;
        }

        .current {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 3px;
            padding: 1px 2px;
            animation: blink 1s infinite, currentGlow 2s infinite;
            position: relative;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        @keyframes currentGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        /* Live Progress Styles */
        .live-progress-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .player-cursor {
            animation: cursorPulse 1s infinite;
        }

        @keyframes cursorPulse {
            0%, 100% { opacity: 1; transform: scaleY(1); }
            50% { opacity: 0.7; transform: scaleY(1.2); }
        }

        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        /* Room Creator Badge */
        .creator-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            animation: badgeGlow 2s infinite;
        }

        @keyframes badgeGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.8); }
        }

        /* Language Selector */
        .language-selector {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .language-selector:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            .typing-text {
                font-size: 1rem;
                line-height: 1.6;
            }
        }

        /* Loading Animation */
        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Success Animation */
        .success-animation {
            animation: successBounce 0.6s ease;
        }

        @keyframes successBounce {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Custom Chain Icon - Realistic Metal Chain */
        .chain-icon {
            position: relative;
            display: inline-block;
            width: 18px;
            height: 14px;
            margin-right: 6px;
        }
        
        .chain-icon::before,
        .chain-icon::after {
            content: '';
            position: absolute;
            border: 2px solid #6b7280;
            border-radius: 50%;
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 50%, #4b5563 100%);
            box-shadow: 
                inset 1px 1px 3px rgba(0,0,0,0.4),
                inset -1px -1px 2px rgba(255,255,255,0.1),
                1px 1px 3px rgba(0,0,0,0.3);
        }
        
        .chain-icon::before {
            width: 14px;
            height: 10px;
            top: 1px;
            left: 2px;
            border-radius: 7px 7px 4px 4px;
            border-bottom: none;
            z-index: 2;
        }
        
        .chain-icon::after {
            width: 14px;
            height: 10px;
            top: 6px;
            left: 2px;
            border-radius: 4px 4px 7px 7px;
            border-top: none;
            z-index: 1;
        }
        
        /* Chain link connection effect */
        .chain-icon::before {
            border-bottom: 1px solid #4b5563;
        }
        
        .chain-icon::after {
            border-top: 1px solid #9ca3af;
        }
        
        /* Hover effect for chain */
        .chain-icon:hover {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }
        
        /* Custom dropdown styling */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1), 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        select option {
            background-color: white;
            color: #7c3aed;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f3f4f6;
            font-weight: 600;
            font-size: 1.5rem;
            line-height: 1.5;
            transition: all 0.2s ease;
        }
        
        select option:hover {
            background-color: #f8fafc;
            color: #5b21b6;
        }
        
        select option:checked,
        select option:focus {
            background-color: #3b82f6;
            color: white;
            font-weight: 700;
        }
        
        select option:first-child {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        
        select option:last-child {
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            border-bottom: none;
        }
    </style>
</head>

<body class="min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- Language Selector -->
        <div class="fixed top-4 right-4 z-50">
            <select v-model="selectedLanguage" @change="changeLanguage"
                class="language-selector border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium shadow-lg">
                <option value="en">🇺🇸 English</option>
                <option value="ru">🇷🇺 Русский</option>
                <option value="uz">🇺🇿 O'zbek</option>
            </select>
        </div>

        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg">
                <i class="fas fa-keyboard text-yellow-300 mr-3"></i>
                {{ translations.title }}
            </h1>
            <p class="text-white text-lg opacity-90">{{ translations.subtitle }}</p>
        </header>



        <!-- Stats Display -->
        <div class="card rounded-lg p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                <div class="stat-card bg-blue-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600">{{ wpm }}</div>
                    <div class="text-sm text-gray-600">{{ translations.wpm }}</div>
                </div>
                <div class="stat-card bg-green-50 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-green-600">{{ accuracy }}%</div>
                    <div class="text-sm text-gray-600">{{ translations.accuracy }}</div>
                </div>
                <div class="stat-card bg-purple-50 p-4 rounded-lg">
                    <div v-if="!testStarted" class="text-center">
                        <select v-model="selectedTime" @change="selectTime(selectedTime)" class="w-full text-center text-2xl font-bold text-purple-600 bg-transparent border-none outline-none cursor-pointer appearance-none">
                            <option value="30" class="bg-white text-purple-600 py-2 px-4 border-b border-gray-200 hover:bg-purple-50">30</option>
                            <option value="60" class="bg-white text-purple-600 py-2 px-4 border-b border-gray-200 hover:bg-purple-50">60</option>
                            <option value="90" class="bg-white text-purple-600 py-2 px-4 border-b border-gray-200 hover:bg-purple-50">90</option>
                            <option value="120" class="bg-white text-purple-600 py-2 px-4 hover:bg-purple-50">120</option>
                        </select>
                        <div class="text-sm text-gray-600">{{ translations.chooseTime || 'Choose Duration' }}</div>
                    </div>
                    <div v-else class="text-center">
                        <div class="text-2xl font-bold text-purple-600">{{ timeLeft }}</div>
                        <div class="text-sm text-gray-600">{{ translations.timeLeft }}</div>
                    </div>
                </div>
                <div class="stat-card bg-orange-50 p-4 rounded-lg">
                    <div class="relative">
                        <div class="bg-white rounded-lg border border-gray-200 p-2 flex items-center justify-between cursor-pointer hover:border-gray-300 transition-colors"
                             @click="showDifficultyDropdown = !showDifficultyDropdown">
                            <div class="flex items-center">
                                <span class="text-lg font-bold text-orange-600 mr-2">
                                    {{ getDifficultyTranslation() }}
                                </span>
                            </div>
                            <i class="fas fa-chevron-down text-gray-500 text-sm transition-transform" 
                               :class="showDifficultyDropdown ? 'rotate-180' : ''"></i>
                        </div>
                        
                        <!-- Dropdown Menu -->
                        <div v-if="showDifficultyDropdown" 
                             class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
                            <button @click="selectDifficulty('easy'); showDifficultyDropdown = false"
                                    class="w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center border-b border-gray-100">
                                <div class="text-sm font-medium text-gray-800">{{ translations.easy || 'Easy' }}</div>
                            </button>
                            <button @click="selectDifficulty('medium'); showDifficultyDropdown = false"
                                    class="w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center border-b border-gray-100">
                                <div class="text-sm font-medium text-gray-800">{{ translations.medium || 'Medium' }}</div>
                            </button>
                            <button @click="selectDifficulty('hard'); showDifficultyDropdown = false"
                                    class="w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center">
                                <div class="text-sm font-medium text-gray-800">{{ translations.hard || 'Hard' }}</div>
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mt-2">{{ translations.difficulty || 'Qiyinlik' }}</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="card rounded-lg p-6 mb-6">
            <!-- Live Players Progress (only in lobby) -->
            <div v-if="inLobby && Object.keys(playerProgress).length > 1" class="mb-6">
                <div class="live-progress-card rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">
                        <i class="fas fa-users mr-2 text-blue-600"></i>
                        {{ translations.liveProgress || 'Live Progress' }}
                    </h3>
                    <div class="space-y-2">
                        <div v-for="(progress, otherPlayerId) in playerProgress" :key="otherPlayerId" 
                             v-if="otherPlayerId != playerId && progress && progress.playerName" 
                             class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 rounded-full mr-2" 
                                     :class="(progress.isTyping || false) ? 'bg-green-500 animate-pulse' : 'bg-gray-400'"></div>
                                <span class="font-medium text-gray-800">{{ progress.playerName || 'Unknown Player' }}</span>
                                <span v-if="progress.isTyping" class="ml-2 text-xs text-green-600">
                                    <i class="fas fa-keyboard mr-1"></i>
                                    {{ translations.typing || 'Typing...' }}
                                </span>
                            </div>
                            <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <span>{{ (progress.position || 0) }}/{{ selectedDifficulty === 'easy' ? currentText.length : currentLine.length }}</span>
                                <span>{{ (progress.wpm || 0) }} {{ translations.wpm || 'WPM' }}</span>
                                <span>{{ (progress.accuracy || 0) }}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test Text Display -->
            <div class="mb-6">
                <!-- Line progress indicators - only show for Medium and Hard levels -->
                <div v-if="selectedDifficulty !== 'easy'" class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-600">
                        <i class="fas fa-align-left mr-1"></i>
                        {{ translations.lineProgress || 'Line' }} {{ currentLineIndex + 1 }} / {{ allLines.length }}
                    </span>
                    <span class="text-sm text-gray-600">
                        <i class="fas fa-keyboard mr-1"></i>
                        {{ userInput.length }} / {{ currentLine.length }} {{ translations.characters || 'characters' }}
                    </span>
                </div>
                <div
                    class="typing-text text-lg leading-relaxed p-4 bg-gray-50 rounded-lg border-2 border-gray-200 min-h-[120px] relative">
                    <span v-for="(char, index) in textArray" :key="index" :class="getCharClass(index)">
                        {{ char }}
                    </span>
                    
                    <!-- Show other players' cursors -->
                    <div v-for="(progress, otherPlayerId) in playerProgress" :key="otherPlayerId" 
                         v-if="otherPlayerId != playerId && progress && progress.isTyping && (progress.position || 0) < textArray.length"
                         class="absolute top-0 pointer-events-none"
                         :style="{ left: ((progress.position || 0) * 10.8) + 'px' }">
                        <div class="w-0.5 h-6 bg-red-500 player-cursor relative">
                            <div class="absolute -top-6 left-0 text-xs text-red-600 font-medium whitespace-nowrap">
                                {{ progress.playerName || 'Unknown Player' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="mb-6">
                <textarea v-model="userInput" @input="handleInput" @keydown="handleKeyDown"
                    :disabled="!testStarted || testFinished" :placeholder="translations.placeholder"
                    class="w-full p-4 text-lg border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none"
                    rows="3">
                </textarea>
            </div>

            <!-- Controls -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button @click="startTest" v-if="!testStarted"
                    class="btn-primary bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold">
                    <i class="fas fa-play mr-2"></i>
                    {{ translations.startTest }}
                </button>

                <button @click="resetTest" v-if="testStarted || testFinished"
                    class="btn-primary bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                    <i class="fas fa-redo mr-2"></i>
                    {{ translations.resetTest }}
                </button>

                <button @click="changeText"
                    class="btn-primary bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold">
                    <i class="fas fa-sync mr-2"></i>
                    {{ translations.newText }} {{ getDifficultyTranslation() }}
                </button>
            </div>
        </div>


        <!-- Results Modal -->
        <div v-if="testFinished" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="card rounded-lg p-8 max-w-md w-full mx-4 success-animation">
                <h2 class="text-2xl font-bold text-center mb-2 text-gray-800">
                    <i class="fas fa-trophy text-yellow-500"></i>
                    {{ translations.testComplete }}
                </h2>
                <p class="text-center text-gray-600 mb-6">
                    <span :class="['px-3 py-1 rounded-full text-sm font-semibold', 
                                selectedDifficulty === 'easy' ? 'bg-green-100 text-green-700' :
                                selectedDifficulty === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                                'bg-red-100 text-red-700']">
                        {{ getDifficultyTranslation() }} {{ translations.level }}
                    </span>
                </p>

                <div class="space-y-4 mb-6">
                    <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                        <span class="font-semibold">{{ translations.wordsPerMinute }}:</span>
                        <span class="text-xl font-bold text-blue-600">{{ finalWpm }}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                        <span class="font-semibold">{{ translations.accuracy }}:</span>
                        <span class="text-xl font-bold text-green-600">{{ finalAccuracy }}%</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                        <span class="font-semibold">{{ translations.charactersTyped }}:</span>
                        <span class="text-xl font-bold text-purple-600">{{ finalCharacters }}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                        <span class="font-semibold">{{ translations.errors }}:</span>
                        <span class="text-xl font-bold text-orange-600">{{ errors }}</span>
                    </div>
                </div>

                <div class="text-center">
                    <div class="flex items-center justify-center mb-4">
                        <div class="loading-spinner rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                        <span class="text-gray-600 font-semibold">{{ translations.redirecting }}</span>
                    </div>
                    <p class="text-sm text-gray-500">{{ translations.redirectDescription }}</p>
                </div>
            </div>
        </div>

        <!-- Lobby Section -->
        <div class="card rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">
                <i class="fas fa-users mr-2 text-blue-600"></i>
                {{ translations.lobby || 'Multiplayer Lobby' }}
            </h2>
            
            <div v-if="!inLobby" class="text-center">
                <!-- Loading State for Room Creation -->
                <div v-if="isCreatingRoom" class="bg-gradient-to-r from-green-100 to-blue-100 p-8 rounded-lg mb-6">
                    <div class="flex flex-col items-center justify-center">
                        <div class="loading-spinner rounded-full h-12 w-12 border-b-4 border-green-600 mb-4"></div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">
                            {{ translations.creatingRoom || 'Creating Room...' }}
                        </h3>
                        <p class="text-gray-600 text-sm">
                            {{ translations.creatingRoomDesc || 'Please wait while we set up your room...' }}
                        </p>
                        <div class="mt-4 flex space-x-1">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>

                <!-- Loading State for Room Joining -->
                <div v-else-if="isJoiningRoom" class="bg-gradient-to-r from-blue-100 to-purple-100 p-8 rounded-lg mb-6">
                    <div class="flex flex-col items-center justify-center">
                        <div class="loading-spinner rounded-full h-12 w-12 border-b-4 border-blue-600 mb-4"></div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">
                            {{ translations.joiningRoom || 'Joining Room...' }}
                        </h3>
                        <p class="text-gray-600 text-sm">
                            {{ translations.joiningRoomDesc || 'Connecting to the room...' }}
                        </p>
                        <div class="mt-4 flex space-x-1">
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>

                <!-- Normal State - Show Buttons -->
                <div v-else>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <button disabled class="bg-gray-400 text-gray-600 px-6 py-3 rounded-lg font-semibold cursor-not-allowed opacity-50 relative">
                            <div class="chain-icon"></div>
                            <i class="fas fa-lock mr-2"></i>
                            {{ translations.createRoom || 'Create Room' }}
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-xs bg-red-500 text-white px-2 py-1 rounded-full">
                                    {{ translations.disabled || 'Disabled' }}
                                </span>
                            </div>
                        </button>
                        <button disabled class="bg-gray-400 text-gray-600 px-6 py-3 rounded-lg font-semibold cursor-not-allowed opacity-50 relative">
                            <div class="chain-icon"></div>
                            <i class="fas fa-lock mr-2"></i>
                            {{ translations.joinRoom || 'Join Room' }}
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-xs bg-red-500 text-white px-2 py-1 rounded-full">
                                    {{ translations.disabled || 'Disabled' }}
                                </span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Join Room Form - Disabled -->
                    <div class="bg-gray-100 p-4 rounded-lg opacity-50">
                        <div class="flex gap-2">
                            <input disabled type="text" :placeholder="translations.enterRoomCode || 'Enter Room Code'" 
                                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg bg-gray-200 cursor-not-allowed">
                            <button disabled class="bg-gray-400 text-gray-600 px-4 py-2 rounded-lg font-semibold cursor-not-allowed">
                                <i class="fas fa-link mr-1"></i>
                                <i class="fas fa-lock mr-2"></i>
                                {{ translations.join || 'Join' }}
                            </button>
                            <button disabled class="bg-gray-400 text-gray-600 px-4 py-2 rounded-lg font-semibold cursor-not-allowed">
                                <i class="fas fa-link mr-1"></i>
                                <i class="fas fa-lock mr-2"></i>
                                {{ translations.cancel || 'Cancel' }}
                            </button>
                        </div>
                        <div class="mt-2 text-center">
                            <span class="text-xs text-red-500 bg-red-100 px-2 py-1 rounded-full">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                {{ translations.featureDisabled || 'This feature is currently disabled' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- In Lobby -->
            <div v-else class="text-center">
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2">
                        <i class="fas fa-door-open mr-2"></i>
                        {{ translations.roomCode || 'Room Code' }}: 
                        <span @click="copyRoomCode" class="cursor-pointer bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-lg transition-colors select-none" title="Click to copy">
                            {{ currentRoomCode }}
                            <i class="fas fa-copy ml-2 text-blue-600"></i>
                        </span>
                    </h3>
                    <p class="text-sm text-blue-600">{{ translations.shareCode || 'Share this code with friends to join' }}</p>
                    <div v-if="codeCopied" class="text-sm text-green-600 mt-2">
                        <i class="fas fa-check mr-1"></i>
                        {{ translations.codeCopied || 'Code copied to clipboard!' }}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">{{ translations.players || 'Players' }}</h4>
                        
                        <!-- Player Name Editor -->
                        <div class="mb-3 p-2 bg-blue-50 rounded-lg">
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ translations.yourName || 'Your Name' }}:</label>
                            <div class="flex gap-2">
                                <input v-model="playerName" @blur="updatePlayerName" @keyup.enter="updatePlayerName" 
                                       class="flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:border-blue-500 focus:outline-none"
                                       :placeholder="translations.enterName || 'Enter your name'">
                                <button @click="updatePlayerName" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    <i class="fas fa-save"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Players List -->
                        <div class="space-y-2">
                            <div v-for="player in players" :key="player.id" 
                                 :class="['p-2 rounded flex items-center justify-between', player.isReady ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600']">
                                <div class="flex items-center">
                                    <i :class="['mr-2', player.isCreator ? 'fas fa-crown text-yellow-600' : 'fas fa-user']"></i>
                                    {{ player.name }}
                                    <span v-if="player.isCreator" class="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">
                                        {{ translations.creator || 'Creator' }}
                                    </span>
                                    <span v-if="player.isReady" class="ml-2 text-green-600">
                                        <i class="fas fa-check"></i>
                                    </span>
                                </div>
                                <div v-if="player.id === playerId" class="text-xs text-gray-500">
                                    {{ translations.you || 'You' }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">
                            {{ translations.roomSettings || 'Room Settings' }}
                            <span v-if="isRoomCreator" class="ml-2 text-xs creator-badge px-2 py-1 rounded-full">
                                <i class="fas fa-crown mr-1"></i>
                                {{ translations.roomCreator || 'Room Creator' }}
                            </span>
                        </h4>
                        <div class="space-y-3 text-sm">
                            <!-- Difficulty Setting -->
                            <div>
                                <label class="block text-gray-700 font-medium mb-1">{{ translations.difficulty || 'Difficulty' }}:</label>
                                <select v-model="selectedDifficulty" @change="updateRoomSettings" 
                                        :disabled="!isRoomCreator"
                                        :class="['w-full px-2 py-1 border rounded text-sm focus:outline-none',
                                                isRoomCreator ? 'border-gray-300 focus:border-blue-500' : 'border-gray-200 bg-gray-100 cursor-not-allowed']">
                                    <option value="easy">{{ translations.easy || 'Easy' }}</option>
                                    <option value="medium">{{ translations.medium || 'Medium' }}</option>
                                    <option value="hard">{{ translations.hard || 'Hard' }}</option>
                                </select>
                                <div v-if="!isRoomCreator" class="text-xs text-gray-500 mt-1">
                                    <i class="fas fa-lock mr-1"></i>
                                    {{ translations.onlyCreatorCanChange || 'Only room creator can change settings' }}
                                </div>
                            </div>
                            
                            <!-- Duration Setting -->
                            <div>
                                <label class="block text-gray-700 font-medium mb-1">{{ translations.duration || 'Duration' }}:</label>
                                <select v-model="selectedTime" @change="updateRoomSettings" 
                                        :disabled="!isRoomCreator"
                                        :class="['w-full px-2 py-1 border rounded text-sm focus:outline-none',
                                                isRoomCreator ? 'border-gray-300 focus:border-blue-500' : 'border-gray-200 bg-gray-100 cursor-not-allowed']">
                                    <option value="30">30 {{ translations.seconds || 'sec' }}</option>
                                    <option value="60">60 {{ translations.seconds || 'sec' }}</option>
                                    <option value="90">90 {{ translations.seconds || 'sec' }}</option>
                                    <option value="120">120 {{ translations.seconds || 'sec' }}</option>
                                </select>
                            </div>
                            
                            <!-- Max Players Setting -->
                            <div>
                                <label class="block text-gray-700 font-medium mb-1">{{ translations.maxPlayers || 'Max Players' }}:</label>
                                <select v-model="maxPlayers" @change="updateRoomSettings" 
                                        :disabled="!isRoomCreator"
                                        :class="['w-full px-2 py-1 border rounded text-sm focus:outline-none',
                                                isRoomCreator ? 'border-gray-300 focus:border-blue-500' : 'border-gray-200 bg-gray-100 cursor-not-allowed']">
                                    <option value="2">2 {{ translations.players || 'Players' }}</option>
                                    <option value="3">3 {{ translations.players || 'Players' }}</option>
                                    <option value="4">4 {{ translations.players || 'Players' }}</option>
                                    <option value="6">6 {{ translations.players || 'Players' }}</option>
                                    <option value="8">8 {{ translations.players || 'Players' }}</option>
                                </select>
                            </div>
                            
                            <!-- Current Players Count -->
                            <div class="pt-2 border-t border-gray-200">
                                <div class="text-gray-600">
                                    {{ translations.currentPlayers || 'Current' }}: {{ players.length }}/{{ maxPlayers }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 justify-center">
                    <button @click="toggleReady" 
                            :class="['px-6 py-3 rounded-lg font-semibold transition-colors',
                                   isReady ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-yellow-600 hover:bg-yellow-700 text-white']">
                        <i class="fas fa-check mr-2"></i>
                        {{ isReady ? (translations.ready || 'Ready') : (translations.notReady || 'Not Ready') }}
                    </button>
                    <button @click="leaveRoom" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        {{ translations.leaveRoom || 'Leave Room' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-white mt-8">
            <p class="opacity-90">{{ translations.footerMessage }}</p>
            <div class="mt-4 pt-4 border-t border-white border-opacity-20">
                <p class="text-sm opacity-75">
                    <i class="fas fa-code mr-1"></i>
                    {{ translations.createdBy }}
                    <span class="font-semibold text-yellow-300">Muhammaddiyorjon</span>
                </p>
            </div>
        </footer>
    </div>

    <script>
        // Developer tools are now enabled for development purposes

        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    selectedLanguage: localStorage.getItem('selectedLanguage') || 'en',
                    translations: this.getTranslations(localStorage.getItem('selectedLanguage') || 'en'),
                    // Test texts organized by difficulty
                    texts: {
                        easy: [
                            "Hi there! How are you doing today? I hope you're having a wonderful time. The weather looks nice outside. Maybe we should go for a walk later. What do you think about that idea?",
                            "Good morning! Did you sleep well last night? I had a strange dream about flying. In my dream, I could soar above the clouds. It felt so real and amazing. Dreams can be so interesting sometimes.",
                            "I love reading books in my free time. My favorite genre is mystery novels. They keep me guessing until the very end. Have you read any good books lately? I'm always looking for recommendations.",
                            "Cooking dinner tonight sounds like a great plan. I think I'll make pasta with tomato sauce. It's simple but delicious. Do you want to help me in the kitchen? We can listen to music while we cook.",
                            "My dog loves playing fetch in the backyard. He runs so fast when I throw the ball. Sometimes he brings it back, sometimes he doesn't. Dogs are such funny and loyal companions.",
                            "The coffee shop downtown has the best pastries. I go there every Saturday morning. The barista knows my usual order by heart. It's nice to have a routine place to visit.",
                            "I'm learning to play the guitar this year. My fingers hurt from pressing the strings. But I'm getting better with practice. Music brings so much joy to my life.",
                            "Yesterday I met an old friend at the grocery store. We hadn't seen each other in years. We talked for almost an hour in the parking lot. It's amazing how time flies by so quickly.",
                            "The sunset tonight was absolutely beautiful. The sky turned orange and pink. I wish I had my camera with me. Nature creates the most amazing artwork every day.",
                            "I'm planning a trip to the beach next month. I love the sound of waves crashing on the shore. Building sandcastles is still fun even as an adult. The ocean always makes me feel peaceful."
                        ],
                        medium: [
                            "I've been working from home for the past two years, and it's been quite an adjustment. At first, I missed the office environment and chatting with colleagues during coffee breaks. Now I appreciate the flexibility and the extra time I save by not commuting.",
                            "My grandmother always told me that cooking is an art form that brings people together. She taught me how to make her famous apple pie when I was twelve. The secret ingredient, she said, was patience and love. I still use her recipe today.",
                            "Last weekend, I decided to clean out my closet and found clothes I hadn't worn in years. It was like discovering a time capsule of my past fashion choices. Some items brought back fond memories, while others made me wonder what I was thinking.",
                            "The local farmers market has become my favorite Saturday morning destination. I love talking to the vendors about their produce and learning about different varieties of vegetables. There's something special about buying food directly from the people who grew it.",
                            "I've been trying to learn Spanish for the past six months using a language learning app. Progress has been slower than I expected, but I can now have basic conversations with my neighbor who speaks Spanish fluently. Practice really does make perfect.",
                            "My best friend and I have been planning a road trip across the country for next summer. We've been researching interesting places to visit and creating a detailed itinerary. The excitement is building as we get closer to our departure date.",
                            "I recently started volunteering at the animal shelter on weekends. The dogs and cats there are so grateful for attention and care. It's incredibly rewarding to help these animals find loving homes. I've even considered adopting one myself.",
                            "The book I'm currently reading is a fascinating biography about a famous scientist. It's amazing to learn about the challenges and breakthroughs that shaped their career. Reading biographies always inspires me to pursue my own goals with more determination.",
                            "I've been experimenting with different coffee brewing methods lately. Each technique produces a unique flavor profile, from the rich taste of French press to the clean finish of pour-over. My kitchen has become a mini coffee laboratory.",
                            "The hiking trail near my house offers breathtaking views of the surrounding mountains. I try to walk there at least twice a week, and each visit reveals something new about the landscape. Nature has a way of putting everything into perspective."
                        ],
                        hard: [
                            "The intricate relationship between quantum mechanics and classical physics continues to fascinate researchers worldwide. Scientists are developing increasingly sophisticated mathematical models to bridge the gap between these seemingly incompatible theories, hoping to unlock the mysteries of our universe's fundamental nature.",
                            "Blockchain technology has revolutionized how we think about digital transactions and data security. The cryptographic principles underlying these systems ensure that information remains tamper-proof while enabling decentralized networks that operate without traditional central authorities or intermediaries.",
                            "Artificial intelligence presents profound philosophical questions about consciousness, creativity, and what it means to be human. As machine learning algorithms become more sophisticated, we must carefully consider the ethical implications of creating systems that might eventually match or exceed human cognitive capabilities.",
                            "Recent neuroscience discoveries have revealed the remarkable adaptability of the human brain throughout our lives. This neuroplasticity demonstrates that our neural pathways can be rewired through focused practice and environmental stimulation, offering new possibilities for education and rehabilitation.",
                            "Modern scientific research increasingly requires collaboration across multiple disciplines, bringing together experts from biology, chemistry, physics, mathematics, and computer science. This interdisciplinary approach has led to groundbreaking discoveries in biotechnology, nanotechnology, and quantum computing.",
                            "The philosophical foundations of knowledge and truth continue to challenge contemporary thinkers. Scientists and philosophers debate the nature of reality, the limits of human understanding, and the criteria for establishing reliable knowledge in our complex, interconnected world.",
                            "Geological processes reveal the dynamic nature of our planet's crust, where immense pressure and temperature conditions transform rock formations over millions of years. These metamorphic processes provide crucial insights into Earth's evolution and the formation of natural resources.",
                            "The biochemical mechanisms governing cellular energy transfer demonstrate the elegant efficiency of biological systems. Complex molecular interactions maintain cellular homeostasis through sophisticated feedback mechanisms, knowledge that's essential for advancing medical treatments.",
                            "Digital communication platforms have fundamentally transformed how humans create meaning, establish social connections, and maintain relationships. These technological innovations have introduced new forms of expression while challenging traditional concepts of identity and authenticity.",
                            "Machine learning algorithms rely on advanced mathematical principles from linear algebra, calculus, and statistics to process vast amounts of data and make predictions. These computational methods raise important questions about algorithmic bias, transparency, and the ethics of automated decision-making.",
                            "The mysterious nature of dark matter and dark energy continues to puzzle astrophysicists, as these invisible components appear to make up most of the universe's mass and energy. Current observational methods and theoretical models struggle to explain these phenomena completely.",
                            "Understanding drug interactions requires knowledge of complex biochemical pathways that can produce unexpected therapeutic effects. This knowledge is crucial for developing safe treatment protocols, especially for patients taking multiple medications or those with complex medical conditions.",
                            "Sustainable architecture integrates environmental considerations with aesthetic and functional design principles. These approaches create buildings that minimize ecological impact while maximizing energy efficiency and occupant comfort through careful material selection and climate-responsive design.",
                            "Cognitive psychology reveals how human reasoning often deviates from purely logical decision-making processes. These mental shortcuts, while evolutionarily adaptive, can lead to systematic errors in judgment, particularly in complex situations requiring careful analysis.",
                            "Globalization has created intricate networks of international trade, finance, and labor that transcend traditional national boundaries. These interconnected systems have generated unprecedented economic growth while also creating new forms of inequality that challenge existing policy frameworks."
                        ],
                        // Russian texts
                        easy_ru: [
                            "Привет! Как дела? Надеюсь, у тебя отличный день. Погода сегодня замечательная. Может быть, стоит прогуляться позже? Что думаешь об этой идее?",
                            "Доброе утро! Хорошо спал прошлой ночью? Мне приснился странный сон о полете. В моем сне я мог парить над облаками. Это было так реально и удивительно.",
                            "Я люблю читать книги в свободное время. Мой любимый жанр - детективы. Они держат в напряжении до самого конца. Читал ли ты что-нибудь интересное в последнее время?",
                            "Приготовить ужин сегодня вечером - отличная идея. Думаю, сделаю пасту с томатным соусом. Это просто, но очень вкусно. Хочешь помочь мне на кухне?",
                            "Моя собака обожает играть в мяч во дворе. Она бегает так быстро, когда я бросаю мяч. Иногда приносит его обратно, иногда нет. Собаки такие забавные и верные друзья.",
                            "В кофейне в центре города самые вкусные пирожные. Я хожу туда каждую субботу утром. Бариста уже знает мой обычный заказ наизусть. Приятно иметь привычное место.",
                            "В этом году я учусь играть на гитаре. Пальцы болят от нажатия на струны. Но с практикой становится лучше. Музыка приносит столько радости в мою жизнь.",
                            "Вчера я встретил старого друга в продуктовом магазине. Мы не виделись много лет. Говорили почти час на парковке. Удивительно, как быстро летит время.",
                            "Сегодняшний закат был просто потрясающим. Небо стало оранжевым и розовым. Жаль, что у меня не было с собой камеры. Природа создает самые удивительные картины каждый день.",
                            "Планирую поездку на пляж в следующем месяце. Мне нравится звук волн, разбивающихся о берег. Строить замки из песка весело даже взрослым. Океан всегда успокаивает меня."
                        ],
                        medium_ru: [
                            "Я работаю из дома уже два года, и это было довольно сложное приспособление. Сначала мне не хватало офисной атмосферы и общения с коллегами во время кофе-брейков. Теперь я ценю гибкость и дополнительное время, которое экономлю на дороге.",
                            "Моя бабушка всегда говорила, что готовка - это искусство, которое объединяет людей. Она научила меня готовить свой знаменитый яблочный пирог, когда мне было двенадцать лет. Секретный ингредиент, говорила она, - это терпение и любовь. Я до сих пор использую ее рецепт.",
                            "На прошлых выходных я решил разобрать свой шкаф и нашел одежду, которую не носил годами. Это было похоже на открытие капсулы времени моих прошлых модных предпочтений. Некоторые вещи вызывали приятные воспоминания, а другие заставляли задуматься.",
                            "Местный фермерский рынок стал моим любимым местом для субботних утренних прогулок. Мне нравится общаться с продавцами об их продукции и узнавать о разных сортах овощей. Есть что-то особенное в покупке еды напрямую у тех, кто ее вырастил.",
                            "Я пытаюсь изучать испанский язык уже шесть месяцев, используя приложение для изучения языков. Прогресс оказался медленнее, чем я ожидал, но теперь я могу вести базовые разговоры с соседом, который свободно говорит по-испански.",
                            "Мы с лучшим другом планируем поездку на автомобиле по стране следующим летом. Мы изучаем интересные места для посещения и составляем подробный маршрут. Волнение нарастает по мере приближения даты отъезда.",
                            "Недавно я начал волонтерить в приюте для животных по выходным. Собаки и кошки там так благодарны за внимание и заботу. Невероятно приятно помогать этим животным найти любящие дома. Я даже подумываю взять одного себе.",
                            "Книга, которую я сейчас читаю, - это увлекательная биография известного ученого. Удивительно узнавать о вызовах и прорывах, которые сформировали их карьеру. Чтение биографий всегда вдохновляет меня более решительно преследовать свои цели.",
                            "Я экспериментирую с разными способами заваривания кофе. Каждая техника создает уникальный вкусовой профиль, от насыщенного вкуса френч-пресса до чистого послевкусия пуровера. Моя кухня превратилась в мини-кофейную лабораторию.",
                            "Тропа для пеших прогулок возле моего дома предлагает захватывающие виды на окружающие горы. Я стараюсь ходить туда как минимум дважды в неделю, и каждый визит открывает что-то новое в пейзаже. Природа умеет ставить все на свои места."
                        ],
                        hard_ru: [
                            "Сложная взаимосвязь между квантовой механикой и классической физикой продолжает очаровывать исследователей по всему миру. Ученые разрабатывают все более сложные математические модели для преодоления разрыва между этими, казалось бы, несовместимыми теориями, надеясь раскрыть тайны фундаментальной природы нашей вселенной.",
                            "Технология блокчейн революционизировала то, как мы думаем о цифровых транзакциях и безопасности данных. Криптографические принципы, лежащие в основе этих систем, гарантируют, что информация остается защищенной от подделки, одновременно обеспечивая децентрализованные сети, которые работают без традиционных центральных властей или посредников.",
                            "Искусственный интеллект ставит глубокие философские вопросы о сознании, творчестве и том, что значит быть человеком. По мере того как алгоритмы машинного обучения становятся более сложными, мы должны тщательно рассматривать этические последствия создания систем, которые могут в конечном итоге соответствовать или превосходить человеческие когнитивные способности.",
                            "Недавние открытия в нейронауке выявили замечательную адаптивность человеческого мозга на протяжении всей нашей жизни. Эта нейропластичность демонстрирует, что наши нейронные пути могут быть перестроены через целенаправленную практику и стимуляцию окружающей среды, предлагая новые возможности для образования и реабилитации.",
                            "Современные научные исследования все чаще требуют сотрудничества между несколькими дисциплинами, объединяя экспертов из биологии, химии, физики, математики и информатики. Этот междисциплинарный подход привел к революционным открытиям в биотехнологии, нанотехнологии и квантовых вычислениях.",
                            "Философские основы знания и истины продолжают бросать вызов современным мыслителям. Ученые и философы спорят о природе реальности, пределах человеческого понимания и критериях установления надежного знания в нашем сложном, взаимосвязанном мире.",
                            "Геологические процессы раскрывают динамическую природу коры нашей планеты, где огромное давление и температурные условия трансформируют горные образования в течение миллионов лет. Эти метаморфические процессы предоставляют важные знания об эволюции Земли и формировании природных ресурсов."
                        ],
                        // Uzbek texts
                        easy_uz: [
                            "Salom! Qalaysiz? Umid qilamanki, sizning kuningiz ajoyib. Bugun ob-havo juda yaxshi. Balki keyinroq sayr qilish kerak? Bu fikr haqida nima deb o'ylaysiz?",
                            "Xayrli tong! Kecha yaxshi uxladizmi? Menga uchish haqida g'alati tush ko'rdim. Tushimda men bulutlar ustida parvoz qila olardim. Bu juda haqiqiy va ajoyib tuyuldi. Tushlar ba'zan juda qiziq bo'ladi.",
                            "Bo'sh vaqtimda kitob o'qishni yaxshi ko'raman. Mening sevimli janrim - detektiv romanlar. Ular meni oxirigacha hayratda qoldiradi. So'nggi paytlarda qiziq kitob o'qidingizmi? Men doimo tavsiyalar qidiraman.",
                            "Bugun kechqurun ovqat pishirish ajoyib fikr. Men makaron va pomidor sousi pishirishni o'ylayman. Bu oddiy, lekin juda mazali. Oshxonada menga yordam berishni xohlaysizmi? Pishirish paytida musiqa tinglashimiz mumkin.",
                            "Mening itim hovlida to'p o'ynashni juda yaxshi ko'radi. Men to'pni otganimda u juda tez yugurib ketadi. Ba'zan uni qaytarib oladi, ba'zan olmaydi. Itlar juda qiziq va sodiq do'stlardir.",
                            "Shaharning markazidagi kofe do'konida eng mazali pirojniylar bor. Men har shanba ertalab u erga boraman. Barista mening odatiy buyurtmamni yoddan biladi. Odatli joyga ega bo'lish yaxshi.",
                            "Bu yil men gitara chalishni o'rganyapman. Barmoqlarim torlarni bosishdan og'riyapti. Lekin mashq bilan yaxshilanib bormoqdaman. Musiqa hayotimga juda ko'p quvonch keltiradi.",
                            "Kecha oziq-ovqat do'konida eski do'stimni uchratdim. Biz yillar davomida ko'rishmagan edik. Avtoto'xtash joyida deyarli bir soat gaplashdik. Vaqt qanchalik tez o'tib ketayotgani hayratlanarli.",
                            "Bugungi quyosh botishi mutlaqo ajoyib edi. Osmon to'q sariq va pushti rangga aylandi. Afsuski, kameram yonimda yo'q edi. Tabiat har kuni eng ajoyib san'at asarlarini yaratadi.",
                            "Kelasi oy dengizga sayohat qilishni rejalashtirib yuribman. Men to'lqinlarning qirg'oqqa urilish tovushini yaxshi ko'raman. Qumdan qal'a qurish katta odamlar uchun ham qiziq. Dengiz meni doimo tinchlantiradi."
                        ],
                        medium_uz: [
                            "Men ikki yildan beri uydan ishlayapman va bu juda katta o'zgarish edi. Dastlab ofis muhitini va kofe tanaffuslarda hamkasblar bilan gaplashishni sog'indim. Endi men moslashuvchanlikni va yo'lda vaqt tejashni qadrlayman.",
                            "Mening buvim doimo pishirish - bu odamlarni birlashtiruvchi san'at ekanligini aytardi. U o'n ikki yoshimda o'zining mashhur olma pirogini pishirishni o'rgatdi. Uning aytishicha, maxfiy ingredient - bu sabr-toqat va sevgi edi. Men hali ham uning retseptidan foydalanaman.",
                            "O'tgan dam olish kunida men shkafimni tozalashga qaror qildim va yillar davomida kiyib ko'rmagan kiyimlarni topdim. Bu mening o'tmishdagi moda tanlovlarimning vaqt kapsulasi kabi edi. Ba'zi narsalar xush xotiralarni qaytarib berdi, boshqalari esa men nima o'ylab kiyganimni hayron qoldirdi.",
                            "Mahalliy fermer bozori mening shanba ertalabki sayohatlarim uchun sevimli joyimga aylandi. Men sotuvchilar bilan ularning mahsulotlari haqida gaplashishni va turli sabzavot navlarini o'rganishni yaxshi ko'raman. Oziq-ovqatni uni yetishtirgan odamlardan to'g'ridan-to'g'ri sotib olishda biror narsa maxsus.",
                            "Men olti oydan beri til o'rganish ilovasi yordamida ispan tilini o'rganishga harakat qilayapman. Jarayon kutilganidan sekinroq bo'ldi, lekin endi men ispan tilini yaxshi biladigan qo'shnim bilan oddiy suhbatlashishim mumkin. Amaliyot haqiqatan ham mukammallikka olib keladi.",
                            "Men va eng yaxshi do'stim kelasi yoz mamlakat bo'ylab avtomobil sayohatini rejalashtirib yuribmiz. Biz tashrif buyurish uchun qiziq joylarni o'rganib, batafsil marshrut tuzib yuribmiz. Ketish sanasiga yaqinlashganda hayajon oshib bormoqda.",
                            "Men yaqinda dam olish kunlari hayvonlar boshpanasida ko'ngilli ishlashni boshladim. U yerdagi itlar va mushuklar diqqat va g'amxo'rlik uchun juda minnatdor. Bu hayvonlarga sevuvchi uylar topishda yordam berish ajoyib his qiladi. Men hatto o'zim uchun birini olishni ham o'ylayapman.",
                            "Men hozir o'qib yotgan kitob mashhur olim haqidagi qiziqarli tarjimai holi. Ular faoliyatini shakllantirgan qiyinchiliklar va yutuqlar haqida bilib olish hayratlanarli. Tarjimai hollar o'qish meni o'z maqsadlarimni yanada qat'iyat bilan amalga oshirishga ilhomlantiradi.",
                            "Men turli kofe tayyorlash usullari bilan tajriba o'tkazib yuribman. Har bir texnika noyob ta'm profili yaratadi, fransuz pressining boy ta'midan tortib, pour-overning toza ta'migacha. Mening oshxonam mini kofe laboratoriyasiga aylanib qoldi.",
                            "Mening uyim yaqinidagi piyoda yurish yo'li atrofdagi tog'larning ajoyib ko'rinishlarini taklif qiladi. Men u erga haftasiga kamida ikki marta borishga harakat qilaman va har bir tashrif landshaftda yangi narsalarni ochib beradi. Tabiat hamma narsani o'z o'rniga qo'yishni biladi."
                        ],
                        hard_uz: [
                            "Kvant mexanikasi va klassik fizika o'rtasidagi murakkab munosabat butun dunyo bo'ylab tadqiqotchilarni hayratda qoldirmoqda. Olimlar bu, ayni paytda mos kelmaydigan nazariyalar o'rtasidagi bo'shliqni to'ldirish uchun tobora murakkab matematik modellarni ishlab chiqmoqda, bizning koinotimizning asosiy tabiatining sirlarini ochishga umid qilmoqda.",
                            "Blokcheyn texnologiyasi raqamli tranzaksiyalar va ma'lumotlar xavfsizligi haqida qanday o'ylashimizda inqilob qildi. Ushbu tizimlarning asosida yotgan kriptografik tamoyillar ma'lumotlar soxtalashtirishdan himoyalanganligini ta'minlaydi, shu bilan birga an'anaviy markaziy hokimiyatlar yoki vositachilarsiz ishlaydigan markazsizlashtirilgan tarmoqlarni ta'minlaydi.",
                            "Sun'iy intellekt ong, ijodkorlik va inson bo'lish nima degani haqida chuqur falsafiy savollar qo'yadi. Mashina o'rganish algoritmlari murakkablashib borayotgani sari, biz inson kognitiv qobiliyatlariga tenglashishi yoki ularni oshirishi mumkin bo'lgan tizimlarni yaratishning axloqiy oqibatlarini diqqat bilan ko'rib chiqishimiz kerak.",
                            "Neuroscience sohasidagi so'nggi kashfiyotlar inson miyasining butun umrimiz davomida ajoyib moslashuvchanligini ochib berdi. Bu nevroplastiklik bizning neyron yo'llarimiz maqsadli mashq va muhit stimulyatsiyasi orqali qayta tiklanishi mumkinligini ko'rsatadi, ta'lim va reabilitatsiya uchun yangi imkoniyatlarni taklif qiladi.",
                            "Zamonaviy ilmiy tadqiqotlar tobora ko'proq biologiya, kimyo, fizika, matematika va informatika kabi bir nechta sohalar o'rtasida hamkorlikni talab qilmoqda. Bu fanlararo yondashuv biotexnologiya, nanotexnologiya va kvant hisoblash sohalarida inqilobiy kashfiyotlarga olib keldi.",
                            "Bilim va haqiqatning falsafiy asoslari zamonaviy mutafakkirlar uchun doimiy muammo bo'lib qolmoqda. Olimlar va faylasuflar realitet tabiati, inson tushunchasining chegaralari va bizning murakkab, o'zaro bog'langan dunyomizda ishonchli bilim o'rnatish mezonlari haqida bahslashmoqda.",
                            "Geologik jarayonlar bizning sayyoramiz qobig'ining dinamik tabiatini ochib beradi, bu yerda katta bosim va harorat sharoitlari millionlab yillar davomida tog' jinslarini o'zgartiradi. Bu metamorfik jarayonlar Yerning evolyutsiyasi va tabiiy resurslarning shakllanishi haqida muhim ma'lumotlar beradi."
                        ]
                    },
                    selectedDifficulty: 'medium',
                    selectedTime: 60,
                    showDifficultyDropdown: false,
                    currentText: "",
                    textArray: [],
                    currentLineIndex: 0,
                    currentLine: "",
                    allLines: [],
                    userInput: "",
                    testStarted: false,
                    testFinished: false,
                    timeLeft: 60,
                    timer: null,
                    charactersTyped: 0,
                    errors: 0,
                    correctChars: 0,
                    startTime: null,
                    // Lobby properties
                    inLobby: false,
                    showJoinRoom: false,
                    roomCode: '',
                    currentRoomCode: '',
                    players: [],
                    isReady: false,
                    playerName: 'Player' + Math.floor(Math.random() * 1000),
                    codeCopied: false,
                    maxPlayers: 4,
                    isRoomCreator: false,
                    playerId: Math.floor(Math.random() * 10000),
                    // Real-time multiplayer properties
                    playerProgress: {},
                    currentPlayerPosition: 0,
                    isTyping: false,
                    typingTimeout: null,
                    syncInterval: null,
                    // Loading states
                    isCreatingRoom: false,
                    isJoiningRoom: false
                }
            },
            computed: {
                wpm() {
                    if (this.charactersTyped === 0) return 0;
                    const timeElapsed = (this.selectedTime - this.timeLeft);
                    if (timeElapsed <= 0) return 0;
                    const minutes = timeElapsed / 60;
                    const wpm = (this.correctChars / 5) / minutes;
                    
                    // Debug log
                    if (this.testStarted || this.testFinished) {
                        console.log('WPM Debug:', {
                            charactersTyped: this.charactersTyped,
                            correctChars: this.correctChars,
                            selectedTime: this.selectedTime,
                            timeLeft: this.timeLeft,
                            timeElapsed: timeElapsed,
                            minutes: minutes,
                            wpm: wpm
                        });
                    }
                    
                    return Math.max(0, Math.round(wpm));
                },
                accuracy() {
                    if (this.charactersTyped === 0) return 100;
                    const accuracy = (this.correctChars / this.charactersTyped) * 100;
                    return Math.round(accuracy * 100) / 100; // Round to 2 decimal places
                },
                finalWpm() {
                    return this.wpm;
                },
                finalAccuracy() {
                    return this.accuracy;
                },
                finalCharacters() {
                    return this.charactersTyped;
                },
                errorRate() {
                    if (this.charactersTyped === 0) return 0;
                    const errorRate = (this.errors / this.charactersTyped) * 100;
                    return Math.round(errorRate * 100) / 100; // Round to 2 decimal places
                },
                timeUsed() {
                    return this.selectedTime - this.timeLeft;
                }
            },
            methods: {
                getTranslations(language) {
                    const translations = {
                        en: {
                            title: "Typing Test",
                            subtitle: "Test your typing speed and accuracy",
                            chooseDifficulty: "Choose Difficulty Level",
                            typingSettings: "Typing Settings",
                            testDuration: "Test Duration",
                            easy: "Easy",
                            medium: "Medium",
                            hard: "Hard",
                            wpm: "WPM",
                            accuracy: "Accuracy",
                            timeLeft: "Time Left",
                            characters: "Characters",
                            placeholder: "Start typing here...",
                            startTest: "Start Test",
                            resetTest: "Reset Test",
                            newText: "New",
                            testComplete: "Test Complete!",
                            level: "Level",
                            wordsPerMinute: "Words Per Minute",
                            charactersTyped: "Characters Typed",
                            errors: "Errors",
                            redirecting: "Redirecting to detailed results...",
                            redirectDescription: "You will be automatically redirected to see your detailed performance analysis",
                            footerMessage: "Practice makes perfect! Keep typing to improve your speed and accuracy.",
                            createdBy: "Created and supported by",
                            lineProgress: "Line",
                            chooseTime: "Choose Test Duration",
                            seconds: "sec",
                            timeDescription: "Select how long you want to practice typing",
                            lobby: "Multiplayer Lobby",
                            createRoom: "Create Room",
                            joinRoom: "Join Room",
                            enterRoomCode: "Enter Room Code",
                            join: "Join",
                            cancel: "Cancel",
                            roomCode: "Room Code",
                            shareCode: "Share this code with friends to join",
                            players: "Players",
                            roomSettings: "Room Settings",
                            duration: "Duration",
                            playersCount: "Players",
                            ready: "Ready",
                            notReady: "Not Ready",
                            leaveRoom: "Leave Room",
                            codeCopied: "Code copied to clipboard!",
                            maxPlayers: "Max Players",
                            currentPlayers: "Current",
                            yourName: "Your Name",
                            enterName: "Enter your name",
                            you: "You",
                            roomCreator: "Room Creator",
                            creator: "Creator",
                            onlyCreatorCanChange: "Only room creator can change settings",
                            liveProgress: "Live Progress",
                            typing: "Typing...",
                            creatingRoom: "Creating Room...",
                            joiningRoom: "Joining Room...",
                            joining: "Joining...",
                            creatingRoomDesc: "Please wait while we set up your room...",
                            joiningRoomDesc: "Connecting to the room...",
                            disabled: "Disabled",
                            featureDisabled: "This feature is currently disabled"
                        },
                        ru: {
                            title: "Тест Печати",
                            subtitle: "Проверьте скорость и точность печати",
                            chooseDifficulty: "Выберите уровень сложности",
                            typingSettings: "Настройки Печати",
                            testDuration: "Длительность Теста",
                            easy: "Легкий",
                            medium: "Средний",
                            hard: "Сложный",
                            wpm: "ЗМ/М",
                            accuracy: "Точность",
                            timeLeft: "Время",
                            characters: "Символы",
                            placeholder: "Начните печатать здесь...",
                            startTest: "Начать тест",
                            resetTest: "Сбросить тест",
                            newText: "Новый",
                            testComplete: "Тест завершен!",
                            level: "уровень",
                            wordsPerMinute: "Слов в минуту",
                            charactersTyped: "Напечатано символов",
                            errors: "Ошибки",
                            redirecting: "Перенаправление к подробным результатам...",
                            redirectDescription: "Вы будете автоматически перенаправлены для просмотра детального анализа производительности",
                            footerMessage: "Практика ведет к совершенству! Продолжайте печатать, чтобы улучшить скорость и точность.",
                            createdBy: "Создано и поддерживается",
                            lineProgress: "Строка",
                            chooseTime: "Выберите продолжительность теста",
                            seconds: "сек",
                            timeDescription: "Выберите, как долго вы хотите практиковаться в печати",
                            lobby: "Мультиплеер Лобби",
                            createRoom: "Создать Комнату",
                            joinRoom: "Присоединиться",
                            enterRoomCode: "Введите код комнаты",
                            join: "Войти",
                            cancel: "Отмена",
                            roomCode: "Код Комнаты",
                            shareCode: "Поделитесь этим кодом с друзьями",
                            players: "Игроки",
                            roomSettings: "Настройки Комнаты",
                            duration: "Продолжительность",
                            playersCount: "Игроки",
                            ready: "Готов",
                            notReady: "Не Готов",
                            leaveRoom: "Покинуть Комнату",
                            codeCopied: "Код скопирован в буфер обмена!",
                            maxPlayers: "Макс. Игроков",
                            currentPlayers: "Текущие",
                            yourName: "Ваше Имя",
                            enterName: "Введите ваше имя",
                            you: "Вы",
                            roomCreator: "Создатель Комнаты",
                            creator: "Создатель",
                            onlyCreatorCanChange: "Только создатель комнаты может изменять настройки",
                            liveProgress: "Живой Прогресс",
                            typing: "Печатает...",
                            creatingRoom: "Создание Комнаты...",
                            joiningRoom: "Подключение к Комнате...",
                            joining: "Подключение...",
                            creatingRoomDesc: "Пожалуйста, подождите, пока мы настраиваем вашу комнату...",
                            joiningRoomDesc: "Подключение к комнате...",
                            disabled: "Отключено",
                            featureDisabled: "Эта функция в настоящее время отключена"
                        },
                        uz: {
                            title: "Yozish Testi",
                            subtitle: "Yozish tezligi va aniqligini sinab ko'ring",
                            chooseDifficulty: "Qiyinlik darajasini tanlang",
                            typingSettings: "Yozish Sozlamalari",
                            testDuration: "Test Davomiyligi",
                            easy: "Oson",
                            medium: "O'rta",
                            hard: "Qiyin",
                            wpm: "S/M",
                            accuracy: "Aniqlik",
                            timeLeft: "Qolgan vaqt",
                            characters: "Belgilar",
                            placeholder: "Bu yerda yozishni boshlang...",
                            startTest: "Testni boshlash",
                            resetTest: "Testni qayta boshlash",
                            newText: "Yangi",
                            testComplete: "Test tugadi!",
                            level: "daraja",
                            wordsPerMinute: "Daqiqada so'z",
                            charactersTyped: "Yozilgan belgilar",
                            errors: "Xatolar",
                            redirecting: "Batafsil natijalarga yo'naltirilmoqda...",
                            redirectDescription: "Batafsil ishlash tahlilini ko'rish uchun avtomatik ravishda yo'naltirilasiz",
                            footerMessage: "Amaliyot mukammallikka olib keladi! Tezlik va aniqlikni yaxshilash uchun yozishni davom eting.",
                            createdBy: "Yaratilgan va qo'llab-quvvatlanadi",
                            lineProgress: "Qator",
                            chooseTime: "Test davomiyligini tanlang",
                            seconds: "son",
                            timeDescription: "Qancha vaqt yozishni mashq qilishni xohlashingizni tanlang",
                            lobby: "Ko'p o'yinchi Lobby",
                            createRoom: "Xona Yaratish",
                            joinRoom: "Xonaga Qo'shilish",
                            enterRoomCode: "Xona kodini kiriting",
                            join: "Qo'shilish",
                            cancel: "Bekor qilish",
                            roomCode: "Xona Kodi",
                            shareCode: "Bu kodni do'stlaringiz bilan ulashing",
                            players: "O'yinchilar",
                            roomSettings: "Xona Sozlamalari",
                            duration: "Davomiyligi",
                            playersCount: "O'yinchilar",
                            ready: "Tayyor",
                            notReady: "Tayyor Emas",
                            leaveRoom: "Xonadan Chiqish",
                            codeCopied: "Kod buferga nusxalandi!",
                            maxPlayers: "Maks. O'yinchilar",
                            currentPlayers: "Joriy",
                            yourName: "Sizning Ismingiz",
                            enterName: "Ismingizni kiriting",
                            you: "Siz",
                            roomCreator: "Xona Yaratuvchisi",
                            creator: "Yaratuvchi",
                            onlyCreatorCanChange: "Faqat xona yaratuvchisi sozlamalarni o'zgartirishi mumkin",
                            liveProgress: "Jonli Jarayon",
                            typing: "Yozyapti...",
                            creatingRoom: "Xona Yaratilmoqda...",
                            joiningRoom: "Xonaga Qo'shilmoqda...",
                            joining: "Qo'shilmoqda...",
                            creatingRoomDesc: "Iltimos, xonangizni sozlashni kutib turing...",
                            joiningRoomDesc: "Xonaga ulanish...",
                            disabled: "O'chirilgan",
                            featureDisabled: "Bu funksiya hozircha o'chirilgan"
                        }
                    };
                    return translations[language] || translations.en;
                },
                changeLanguage() {
                    this.translations = this.getTranslations(this.selectedLanguage);
                    // Save language preference to localStorage
                    localStorage.setItem('selectedLanguage', this.selectedLanguage);
                    this.generateRandomText();
                },
                getDifficultyTranslation() {
                    const difficultyTranslations = {
                        en: { easy: "Easy", medium: "Medium", hard: "Hard" },
                        ru: { easy: "Легкий", medium: "Средний", hard: "Сложный" },
                        uz: { easy: "Oson", medium: "O'rta", hard: "Qiyin" }
                    };
                    return difficultyTranslations[this.selectedLanguage][this.selectedDifficulty];
                },
                selectDifficulty(level) {
                    this.selectedDifficulty = level;
                    this.generateRandomText();
                    this.resetTest();
                },
                selectTime(time) {
                    this.selectedTime = parseInt(time);
                    this.timeLeft = parseInt(time);
                    this.resetTest();
                },
                // Lobby methods
                createRoom() {
                    this.isCreatingRoom = true;
                    
                    // Simulate room creation delay for better UX
                    setTimeout(() => {
                        this.currentRoomCode = this.generateRoomCode();
                        this.inLobby = true;
                        this.isRoomCreator = true;
                        this.players = [{
                            id: this.playerId,
                            name: this.playerName,
                            isReady: false,
                            isCreator: true
                        }];
                        this.isReady = false;
                        this.showJoinRoom = false;
                        this.isCreatingRoom = false;
                        
                        // Start real-time synchronization
                        this.startRealTimeSync();
                        
                        // Save room data to localStorage
                        localStorage.setItem('currentRoom', JSON.stringify({
                            roomCode: this.currentRoomCode,
                            isRoomCreator: this.isRoomCreator,
                            playerId: this.playerId
                        }));
                        
                        // Sync initial room settings
                        this.syncRoomSettings({
                            difficulty: this.selectedDifficulty,
                            duration: this.selectedTime,
                            maxPlayers: this.maxPlayers,
                            currentText: this.currentText,
                            textArray: this.textArray,
                            allLines: this.allLines,
                            language: this.selectedLanguage
                        });
                    }, 1500); // 1.5 second delay
                },
                joinRoom() {
                    if (this.roomCode.trim()) {
                        this.isJoiningRoom = true;
                        
                        // Simulate joining delay for better UX
                        setTimeout(() => {
                            this.currentRoomCode = this.roomCode.trim().toUpperCase();
                            this.inLobby = true;
                            this.isRoomCreator = false;
                            this.players = [{
                                id: this.playerId,
                                name: this.playerName,
                                isReady: false,
                                isCreator: false
                            }];
                            this.isReady = false;
                            this.showJoinRoom = false;
                            this.roomCode = '';
                            this.isJoiningRoom = false;
                            
                            // Start real-time synchronization
                            this.startRealTimeSync();
                            
                            // Save room data to localStorage
                            localStorage.setItem('currentRoom', JSON.stringify({
                                roomCode: this.currentRoomCode,
                                isRoomCreator: this.isRoomCreator,
                                playerId: this.playerId
                            }));
                            
                            // Try to sync with room settings
                            this.syncWithRoomSettings();
                        }, 1200); // 1.2 second delay
                    }
                },
                leaveRoom() {
                    this.inLobby = false;
                    this.currentRoomCode = '';
                    this.players = [];
                    this.isReady = false;
                    this.showJoinRoom = false;
                    this.roomCode = '';
                    this.isRoomCreator = false;
                    
                    // Stop real-time synchronization
                    this.stopRealTimeSync();
                    
                    // Clear room data from localStorage
                    localStorage.removeItem('currentRoom');
                },
                toggleReady() {
                    this.isReady = !this.isReady;
                    // Update player status in the list
                    const playerIndex = this.players.findIndex(p => p.id === this.playerId);
                    if (playerIndex !== -1) {
                        this.players[playerIndex].isReady = this.isReady;
                    }
                },
                generateRoomCode() {
                    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                    let result = '';
                    for (let i = 0; i < 6; i++) {
                        result += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    return result;
                },
                copyRoomCode() {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(this.currentRoomCode).then(() => {
                            this.codeCopied = true;
                            setTimeout(() => {
                                this.codeCopied = false;
                            }, 2000);
                        }).catch(() => {
                            this.fallbackCopyRoomCode();
                        });
                    } else {
                        this.fallbackCopyRoomCode();
                    }
                },
                fallbackCopyRoomCode() {
                    const textArea = document.createElement('textarea');
                    textArea.value = this.currentRoomCode;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        this.codeCopied = true;
                        setTimeout(() => {
                            this.codeCopied = false;
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy room code:', err);
                    }
                    document.body.removeChild(textArea);
                },
                updateRoomSettings() {
                    // Only room creator can change settings
                    if (!this.isRoomCreator) {
                        console.log('Only room creator can change settings');
                        return;
                    }
                    
                    // Update time left when duration changes
                    this.timeLeft = parseInt(this.selectedTime);
                    
                    // Generate new text when difficulty changes
                    this.generateRandomText();
                    
                    // Reset test if it was started
                    if (this.testStarted) {
                        this.resetTest();
                    }
                    
                    // Sync settings with other players
                    this.syncRoomSettings({
                        difficulty: this.selectedDifficulty,
                        duration: this.selectedTime,
                        maxPlayers: this.maxPlayers,
                        currentText: this.currentText,
                        textArray: this.textArray,
                        allLines: this.allLines
                    });
                    
                    console.log('Room settings updated:', {
                        difficulty: this.selectedDifficulty,
                        duration: this.selectedTime,
                        maxPlayers: this.maxPlayers
                    });
                },
                updatePlayerName() {
                    // Trim whitespace and validate name
                    const newName = this.playerName.trim();
                    if (newName && newName.length > 0 && newName.length <= 20) {
                        // Update player name in the players list
                        const playerIndex = this.players.findIndex(p => p.id === this.playerId);
                        if (playerIndex !== -1) {
                            this.players[playerIndex].name = newName;
                        }
                        
                        // Here you would typically send the name change to other players
                        console.log('Player name updated to:', newName);
                    } else {
                        // Reset to previous name if invalid
                        const playerIndex = this.players.findIndex(p => p.id === this.playerId);
                        if (playerIndex !== -1) {
                            this.playerName = this.players[playerIndex].name;
                        }
                    }
                },
                getDifficultyDescription() {
                    const descriptions = {
                        en: {
                            easy: "Simple words, short sentences, common vocabulary",
                            medium: "Mixed complexity, moderate sentence length, varied vocabulary",
                            hard: "Complex words, long sentences, technical and academic vocabulary"
                        },
                        ru: {
                            easy: "Простые слова, короткие предложения, обычная лексика",
                            medium: "Смешанная сложность, умеренная длина предложений, разнообразная лексика",
                            hard: "Сложные слова, длинные предложения, техническая и академическая лексика"
                        },
                        uz: {
                            easy: "Oddiy so'zlar, qisqa jumlalar, umumiy lug'at",
                            medium: "Aralash murakkablik, o'rta jumla uzunligi, xilma-xil lug'at",
                            hard: "Murakkab so'zlar, uzun jumlalar, texnik va akademik lug'at"
                        }
                    };
                    return descriptions[this.selectedLanguage][this.selectedDifficulty];
                },
                generateRandomText() {
                    let textKey = this.selectedDifficulty;
                    if (this.selectedLanguage !== 'en') {
                        textKey = `${this.selectedDifficulty}_${this.selectedLanguage}`;
                    }
                    
                    const difficultyTexts = this.texts[textKey] || this.texts[this.selectedDifficulty];
                    const randomIndex = Math.floor(Math.random() * difficultyTexts.length);
                    this.currentText = difficultyTexts[randomIndex];
                    
                    // For Easy level, show full text. For Medium/Hard, split into lines
                    if (this.selectedDifficulty === 'easy') {
                        this.textArray = this.currentText.split('');
                        this.allLines = [this.currentText];
                        this.currentLineIndex = 0;
                        this.currentLine = this.currentText;
                    } else {
                        // Split text into lines (approximately 60-80 characters per line)
                        this.allLines = this.splitTextIntoLines(this.currentText, 70);
                        this.currentLineIndex = 0;
                        this.currentLine = this.allLines[0] || "";
                        this.textArray = this.currentLine.split('');
                    }
                },
                splitTextIntoLines(text, maxLength) {
                    const words = text.split(' ');
                    const lines = [];
                    let currentLine = '';

                    for (let word of words) {
                        if ((currentLine + word).length <= maxLength) {
                            currentLine += (currentLine ? ' ' : '') + word;
                        } else {
                            if (currentLine) {
                                lines.push(currentLine);
                                currentLine = word;
                            } else {
                                // If single word is longer than maxLength, split it
                                lines.push(word);
                            }
                        }
                    }

                    if (currentLine) {
                        lines.push(currentLine);
                    }

                    return lines;
                },
                startTest() {
                    this.testStarted = true;
                    this.testFinished = false;
                    this.userInput = "";
                    this.charactersTyped = 0;
                    this.errors = 0;
                    this.correctChars = 0;
                    this.timeLeft = parseInt(this.selectedTime);
                    this.currentLineIndex = 0;
                    this.currentLine = this.allLines[0] || "";
                    this.textArray = this.currentLine.split('');
                    this.startTime = Date.now();
                    
                    // Clear any existing timer
                    if (this.timer) {
                        clearInterval(this.timer);
                    }
                    
                    this.timer = setInterval(() => {
                        if (this.testStarted && !this.testFinished) {
                            this.timeLeft--;
                            if (this.timeLeft <= 0) {
                                this.finishTest();
                            }
                        }
                    }, 1000);
                },
                handleInput() {
                    if (!this.testStarted) return;
                    
                    // Set typing status
                    this.isTyping = true;
                    this.currentPlayerPosition = this.userInput.length;
                    
                    // Clear previous timeout
                    if (this.typingTimeout) {
                        clearTimeout(this.typingTimeout);
                    }
                    
                    // Set timeout to mark as not typing after 1 second of inactivity
                    this.typingTimeout = setTimeout(() => {
                        this.isTyping = false;
                        this.syncPlayerProgress();
                    }, 1000);
                    
                    const inputLength = this.userInput.length;
                    
                    if (this.selectedDifficulty === 'easy') {
                        // For Easy level, work with full text
                        let correct = 0;
                        let incorrect = 0;
                        
                        for (let i = 0; i < inputLength; i++) {
                            if (this.userInput[i] === this.currentText[i]) {
                                correct++;
                            } else {
                                incorrect++;
                            }
                        }
                        
                        this.charactersTyped = inputLength;
                        this.correctChars = correct;
                        this.errors = incorrect;
                        
                        // Check if test is complete
                        if (inputLength >= this.currentText.length) {
                            this.finishTest();
                        }
                    } else {
                        // For Medium/Hard levels, work with lines
                        let correct = 0;
                        let incorrect = 0;
                        
                        for (let i = 0; i < inputLength; i++) {
                            if (this.userInput[i] === this.currentLine[i]) {
                                correct++;
                            } else {
                                incorrect++;
                            }
                        }
                        
                        // Update total counts (accumulate across all lines)
                        let totalChars = 0;
                        let totalCorrect = 0;
                        let totalErrors = 0;
                        
                        // Add completed lines
                        for (let i = 0; i < this.currentLineIndex; i++) {
                            totalChars += this.allLines[i].length;
                            totalCorrect += this.allLines[i].length; // Assume completed lines are correct
                        }
                        
                        // Add current line progress
                        totalChars += inputLength;
                        totalCorrect += correct;
                        totalErrors += incorrect;
                        
                        this.charactersTyped = totalChars;
                        this.correctChars = totalCorrect;
                        this.errors = totalErrors;
                        
                        // Check if current line is complete
                        if (inputLength >= this.currentLine.length) {
                            this.advanceToNextLine();
                        }
                    }
                    
                    // Sync progress with other players
                    this.syncPlayerProgress();
                },
                advanceToNextLine() {
                    // Move to next line
                    this.currentLineIndex++;
                    
                    // Check if we've completed all lines
                    if (this.currentLineIndex >= this.allLines.length) {
                        this.finishTest();
                        return;
                    }
                    
                    // Update to next line
                    this.currentLine = this.allLines[this.currentLineIndex];
                    this.textArray = this.currentLine.split('');
                    this.userInput = ""; // Reset input for new line
                },
                handleKeyDown(event) {
                    if (event.key === 'Backspace' && this.userInput.length > 0) {
                        // Allow backspace
                        return;
                    }

                    // Prevent other special keys
                    if (event.key.length > 1 && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
                        event.preventDefault();
                    }
                },
                finishTest() {
                    this.testFinished = true;
                    this.testStarted = false;
                    clearInterval(this.timer);

                    // Save results and redirect to results page
                    const results = {
                        wpm: this.wpm,
                        accuracy: this.accuracy,
                        characters: this.charactersTyped,
                        correctChars: this.correctChars,
                        errors: this.errors,
                        errorRate: this.errorRate,
                        timeUsed: this.timeUsed,
                        difficulty: this.selectedDifficulty
                    };

                    localStorage.setItem('typingResults', JSON.stringify(results));

                    // Redirect to results page after a short delay
                    setTimeout(() => {
                        window.location.href = `results.html?wpm=${results.wpm}&accuracy=${results.accuracy}&characters=${results.characters}&correctChars=${results.correctChars}&errors=${results.errors}&errorRate=${results.errorRate}&timeUsed=${results.timeUsed}&difficulty=${results.difficulty}`;
                    }, 2000);
                },
                resetTest() {
                    this.testStarted = false;
                    this.testFinished = false;
                    this.userInput = "";
                    this.charactersTyped = 0;
                    this.errors = 0;
                    this.correctChars = 0;
                    this.timeLeft = parseInt(this.selectedTime);
                    this.currentLineIndex = 0;
                    this.currentLine = this.allLines[0] || "";
                    this.textArray = this.currentLine.split('');
                    if (this.timer) {
                        clearInterval(this.timer);
                        this.timer = null;
                    }
                },
                changeText() {
                    this.generateRandomText();
                    this.resetTest();
                },
                getCharClass(index) {
                    if (index < this.userInput.length) {
                        if (this.selectedDifficulty === 'easy') {
                            if (this.userInput[index] === this.currentText[index]) {
                                return 'correct';
                            } else {
                                return 'incorrect';
                            }
                        } else {
                            if (this.userInput[index] === this.currentLine[index]) {
                                return 'correct';
                            } else {
                                return 'incorrect';
                            }
                        }
                    } else if (index === this.userInput.length && this.testStarted) {
                        return 'current';
                    }
                    return '';
                },
                // Real-time multiplayer methods
                syncRoomSettings(settings) {
                    // In a real implementation, this would send data via WebSocket
                    // For now, we'll simulate with localStorage for demo purposes
                    const roomData = {
                        roomCode: this.currentRoomCode,
                        settings: settings,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(`room_${this.currentRoomCode}`, JSON.stringify(roomData));
                },
                syncPlayerProgress() {
                    if (!this.inLobby) return;
                    
                    const progress = {
                        playerId: this.playerId,
                        playerName: this.playerName || 'Unknown Player',
                        position: this.userInput ? this.userInput.length : 0,
                        isTyping: this.isTyping || false,
                        wpm: this.wpm || 0,
                        accuracy: this.accuracy || 0,
                        timestamp: Date.now()
                    };
                    
                    // Update local progress
                    this.playerProgress[this.playerId] = progress;
                    
                    // In real implementation, send via WebSocket
                    const roomData = {
                        roomCode: this.currentRoomCode,
                        playerProgress: this.playerProgress,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(`progress_${this.currentRoomCode}`, JSON.stringify(roomData));
                },
                updatePlayerProgress() {
                    if (!this.inLobby || !this.currentRoomCode) return;
                    
                    // Simulate receiving updates from other players
                    const progressData = localStorage.getItem(`progress_${this.currentRoomCode}`);
                    if (progressData) {
                        try {
                            const data = JSON.parse(progressData);
                            if (data.roomCode === this.currentRoomCode && data.playerProgress) {
                                // Safely merge progress data
                                Object.keys(data.playerProgress).forEach(playerId => {
                                    const progress = data.playerProgress[playerId];
                                    if (progress && typeof progress === 'object') {
                                        this.playerProgress[playerId] = {
                                            playerId: progress.playerId || playerId,
                                            playerName: progress.playerName || 'Unknown Player',
                                            position: progress.position || 0,
                                            isTyping: progress.isTyping || false,
                                            wpm: progress.wpm || 0,
                                            accuracy: progress.accuracy || 0,
                                            timestamp: progress.timestamp || Date.now()
                                        };
                                    }
                                });
                            }
                        } catch (e) {
                            console.error('Error parsing progress data:', e);
                        }
                    }
                },
                startRealTimeSync() {
                    // Start syncing every 100ms for real-time feel
                    this.syncInterval = setInterval(() => {
                        if (this.inLobby) {
                            this.updatePlayerProgress();
                        }
                    }, 100);
                },
                stopRealTimeSync() {
                    if (this.syncInterval) {
                        clearInterval(this.syncInterval);
                        this.syncInterval = null;
                    }
                },
                getPlayerProgress(playerId) {
                    return this.playerProgress[playerId] || {
                        position: 0,
                        isTyping: false,
                        wpm: 0,
                        accuracy: 0,
                        playerName: 'Unknown Player'
                    };
                },
                getPlayerPosition(playerId) {
                    const progress = this.getPlayerProgress(playerId);
                    return progress.position || 0;
                },
                isPlayerTyping(playerId) {
                    const progress = this.getPlayerProgress(playerId);
                    return progress.isTyping || false;
                },
                syncWithRoomSettings() {
                    // Try to get room settings from localStorage
                    const roomData = localStorage.getItem(`room_${this.currentRoomCode}`);
                    if (roomData) {
                        try {
                            const data = JSON.parse(roomData);
                            if (data.roomCode === this.currentRoomCode && data.settings) {
                                const settings = data.settings;
                                
                                // Sync language
                                if (settings.language && settings.language !== this.selectedLanguage) {
                                    this.selectedLanguage = settings.language;
                                    this.translations = this.getTranslations(settings.language);
                                }
                                
                                // Sync difficulty
                                if (settings.difficulty) {
                                    this.selectedDifficulty = settings.difficulty;
                                }
                                
                                // Sync duration
                                if (settings.duration) {
                                    this.selectedTime = settings.duration;
                                    this.timeLeft = settings.duration;
                                }
                                
                                // Sync max players
                                if (settings.maxPlayers) {
                                    this.maxPlayers = settings.maxPlayers;
                                }
                                
                                // Sync text content
                                if (settings.currentText) {
                                    this.currentText = settings.currentText;
                                }
                                if (settings.textArray) {
                                    this.textArray = settings.textArray;
                                }
                                if (settings.allLines) {
                                    this.allLines = settings.allLines;
                                }
                                
                                console.log('Synced with room settings:', settings);
                            }
                        } catch (e) {
                            console.error('Error parsing room settings:', e);
                        }
                    }
                }
            },
            mounted() {
                // Load saved language preference
                const savedLanguage = localStorage.getItem('selectedLanguage');
                if (savedLanguage && ['en', 'ru', 'uz'].includes(savedLanguage)) {
                    this.selectedLanguage = savedLanguage;
                    this.translations = this.getTranslations(savedLanguage);
                }
                this.generateRandomText();
                
                // Check if we're already in a room (for page refresh)
                const currentRoom = localStorage.getItem('currentRoom');
                if (currentRoom) {
                    try {
                        const roomData = JSON.parse(currentRoom);
                        this.currentRoomCode = roomData.roomCode;
                        this.inLobby = true;
                        this.isRoomCreator = roomData.isRoomCreator;
                        this.playerId = roomData.playerId;
                        this.startRealTimeSync();
                    } catch (e) {
                        console.error('Error loading room data:', e);
                    }
                }
            },
            beforeUnmount() {
                // Clean up intervals and timeouts
                this.stopRealTimeSync();
                if (this.typingTimeout) {
                    clearTimeout(this.typingTimeout);
                }
                if (this.timer) {
                    clearInterval(this.timer);
                }
            }
        }).mount('#app');
    </script>
</body>

</html>